services:
  postgres:
    image: postgres:16-alpine
    container_name: reminder-postgres
    restart: unless-stopped

    environment:
      POSTGRES_DB: reminder
      POSTGRES_USER: reminder
      POSTGRES_PASSWORD: reminder_secret

    volumes:
      - pgdata:/var/lib/postgresql/data

    networks:
      - proxy_network

    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U reminder"]
      interval: 5s
      timeout: 5s
      retries: 5

    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  reminder-bot:
    build: .
    image: bpsprovkaltara/reminder-presensi-bps:latest
    container_name: bpsprovkaltara-reminder-presensi-bps
    restart: unless-stopped

    depends_on:
      postgres:
        condition: service_healthy

    ports:
      - "3000:3000"

    volumes:
      - ./.wwebjs_auth:/app/.wwebjs_auth
      - ./.wwebjs_cache:/app/.wwebjs_cache
      - ./data:/app/data

    environment:
      - TZ=Asia/Makassar
      - DATABASE_URL=postgresql://reminder:reminder_secret@postgres:5432/reminder

    shm_size: '512mb'
    stop_grace_period: 15s

    networks:
      - proxy_network

    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  pgdata:

networks:
  proxy_network:
    external: true
